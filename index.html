<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¦çš®æ‰‹çºŒè²»åˆ©æ½¤è¨ˆç®—æ©Ÿ (2026 å°ˆæ¥­ç‰ˆ)</title>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .text-shopee { color: #ee4d2d; }
    .bg-shopee { background-color: #ee4d2d; }
    .border-shopee { border-color: #ee4d2d; }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #ee4d2d; }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const YouTubeIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
      </svg>
    );

    const InstagramIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
        <path d="M16 11.37A4 0 1 1 12.63 8 4 0 0 1 16 11.37z"></path>
        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
      </svg>
    );

    // âœ… å°é©šå˜†è™Ÿé€£çµï¼ˆå¯é‡ç”¨ï¼‰
    const InfoLink = ({ href, label }) => (
      <a
        href={href}
        target="_blank"
        rel="noopener noreferrer"
        aria-label={label}
        title={label}
        className="inline-flex items-center justify-center w-5 h-5 ml-2 rounded-full border border-gray-300 text-gray-500 hover:text-shopee hover:border-shopee transition-colors bg-white"
      >
        <span className="text-xs font-bold leading-none">!</span>
      </a>
    );

    const Calculator = () => {
      const [mode, setMode] = useState('profit'); // 'profit' or 'price'
      const [sellerType, setSellerType] = useState('general'); // 'general' or 'mall'

      // Inputs
      const [price, setPrice] = useState('');
      const [targetMargin, setTargetMargin] = useState('30');
      const [cost, setCost] = useState('');

      // Extra expense ratios
      const [opExpenseRate, setOpExpenseRate] = useState('0');     // ç¶“ç‡Ÿè²»ç”¨ä½”æ¯”
      const [marketingRate, setMarketingRate] = useState('0');     // è¡ŒéŠ·è²»ç”¨ä½”æ¯”

      // Hero
      const [heroOk, setHeroOk] = useState(true);

      // Rates
      // âœ… æˆäº¤æ‰‹çºŒè²»ï¼šåªå­˜ã€ŒåŸºç¤è²»ç‡ã€ï¼Œæª”æœŸ/å‚™è²¨åœ¨è¨ˆç®—æ™‚ç–ŠåŠ ï¼ˆä¸è¦†è“‹ä½¿ç”¨è€…è¼¸å…¥ï¼‰
      const [transFeeRate, setTransFeeRate] = useState(6.5);
      // âœ… æ´»å‹•æœå‹™è²»ï¼šå…é‹æ–¹æ¡ˆ 6%
      const [serviceFeeRate, setServiceFeeRate] = useState(0);
      const [paymentFeeRate, setPaymentFeeRate] = useState(2.5);
      const [taxRate, setTaxRate] = useState(0);
      const [isShopeeInvoice, setIsShopeeInvoice] = useState(false);

      // Toggles
      const [isPromo, setIsPromo] = useState(false);
      const [isFSS, setIsFSS] = useState(false);
      const [ccbType, setCcbType] = useState('none'); // 'none', '10', '5'
      const [isPreOrder, setIsPreOrder] = useState(false);

      // âœ… ä¾è³£å ´é¡å‹è¨­å®šã€Œé è¨­ã€æˆäº¤æ‰‹çºŒè²»ï¼ˆå¯è¢«ä½¿ç”¨è€…æ‰‹å‹•ä¿®æ”¹ï¼‰
      useEffect(() => {
        if (sellerType === 'general') setTransFeeRate(6.5); // ä¸€èˆ¬è³£å®¶ï¼šéæª”æœŸé è¨­ 6.5%
        if (sellerType === 'mall') setTransFeeRate(9.0);    // å•†åŸ/å…¶ä»–ï¼šéæª”æœŸé è¨­ 9%
      }, [sellerType]);

      // âœ… æ´»å‹•æœå‹™è²»ï¼šFSS = 6% + è¦å¹£ï¼ˆ10%å›é¥‹åœ¨åƒåŠ FSSæ™‚ -0.5%ï¼‰
      useEffect(() => {
        let sRate = 0;

        if (isFSS) sRate += 6.0;

        if (ccbType === '10') {
          let ccbRate = 3.0;
          if (isFSS) ccbRate -= 0.5; // 2.5%
          sRate += ccbRate;
        } else if (ccbType === '5') {
          sRate += 1.5;
        }

        setServiceFeeRate(sRate);
      }, [isFSS, ccbType]);

      const handleTaxSelection = (type) => {
        if (type === '0') { setTaxRate(0); setIsShopeeInvoice(false); }
        else if (type === '1') { setTaxRate(1); setIsShopeeInvoice(false); }
        else if (type === '5') { setTaxRate(5); setIsShopeeInvoice(false); }
        else if (type === 'shopee') { setTaxRate(5); setIsShopeeInvoice(true); }
      };

      // --- Core Calculation ---
      const calculateScenario = (
        p, c, q,
        r_trans_base_percent, r_serv_percent, r_pay_percent, r_tax_percent,
        scheme2_fee,
        is_pre_order, s_type,
        use_shopee_invoice,
        is_promo,
        r_op_expense, r_mkt_expense
      ) => {
        const numP = parseFloat(p) || 0;
        const numQ = parseFloat(q) || 1;
        const totalSales = numP * numQ;

        // 1) Transaction fee
        let effectiveTransRate = parseFloat(r_trans_base_percent) || 0;

        if (is_promo) {
          if (s_type === 'general') effectiveTransRate += 2.0;
          if (s_type === 'mall') effectiveTransRate += 3.0;
        }

        if (is_pre_order) effectiveTransRate += 3.0;

        let transFeeBase = totalSales;
        let capApplied = false;
        if (s_type === 'general') {
          const cappedItemPrice = Math.min(numP, 35000);
          if (numP > 35000) capApplied = true;
          transFeeBase = cappedItemPrice * numQ;
        }
        const transFee = Math.round(transFeeBase * (effectiveTransRate / 100));

        // 2) Service fee
        const serviceFee = Math.round(totalSales * ((parseFloat(r_serv_percent) || 0) / 100));

        // 3) Payment fee
        const paymentFee = Math.round(totalSales * ((parseFloat(r_pay_percent) || 0) / 100));

        // 4) Tax
        const baseTaxAmount = Math.round(totalSales * ((parseFloat(r_tax_percent) || 0) / 100));
        const shopeeInvoiceFee = use_shopee_invoice ? 3 : 0; // 2.5 -> å››æ¨äº”å…¥ 3
        const taxAmount = baseTaxAmount + shopeeInvoiceFee;

        // 5) Scheme 2 fee
        const scheme2Cost = scheme2_fee > 0 ? parseFloat(scheme2_fee) : 0;

        // 6) Extra expense ratios
        const opExp = Math.round(totalSales * ((parseFloat(r_op_expense) || 0) / 100));
        const mktExp = Math.round(totalSales * ((parseFloat(r_mkt_expense) || 0) / 100));

        const totalFees = transFee + serviceFee + paymentFee + taxAmount + scheme2Cost;

        const productCost = Math.round(((parseFloat(c) || 0) * numQ));
        const operatingProfit = totalSales
          - totalFees
          - productCost
          - opExp
          - mktExp;

        const operatingMargin = totalSales > 0 ? (operatingProfit / totalSales) * 100 : 0;

        return {
          totalSales,
          transFee,
          serviceFee,
          paymentFee,
          taxAmount,
          shopeeInvoiceFee,
          sellerExtraShippingCost: scheme2Cost,
          opExp,
          mktExp,
          totalFees,
          operatingProfit,
          operatingMargin,
          capApplied,
          effectiveTransRate
        };
      };

      const calculatePriceReverse = (
        targetMarginPercent, c,
        r_trans_base_percent, r_serv_percent, r_pay_percent, r_tax_percent,
        scheme2_fee, is_pre_order, s_type, use_shopee_invoice,
        is_promo,
        r_op_expense, r_mkt_expense
      ) => {
        if (!c || parseFloat(c) <= 0) return 0;
        const costVal = parseFloat(c);

        let min = costVal;
        let max = costVal * 10 + 200000;
        let bestPrice = max;

        for (let i = 0; i < 25; i++) {
          let mid = (min + max) / 2;
          let testPrice = Math.ceil(mid);

          const res = calculateScenario(
            testPrice, c, 1,
            r_trans_base_percent, r_serv_percent, r_pay_percent, r_tax_percent,
            scheme2_fee, is_pre_order, s_type, use_shopee_invoice,
            is_promo,
            r_op_expense, r_mkt_expense
          );

          if (res.operatingMargin < targetMarginPercent) min = mid;
          else { bestPrice = testPrice; max = mid; }
        }
        return bestPrice;
      };

      const mainResults = useMemo(() => {
        const quantity = 1;
        let calculatedPrice = parseFloat(price) || 0;
        let isImpossible = false;

        if (mode === 'price') {
          calculatedPrice = calculatePriceReverse(
            parseFloat(targetMargin) || 0,
            cost,
            transFeeRate, serviceFeeRate, paymentFeeRate, taxRate,
            0, isPreOrder, sellerType, isShopeeInvoice,
            isPromo,
            opExpenseRate, marketingRate
          );
          if (calculatedPrice <= 0 && (parseFloat(targetMargin) || 0) > 0) isImpossible = true;
        }

        const res = calculateScenario(
          calculatedPrice, cost, quantity,
          transFeeRate, serviceFeeRate, paymentFeeRate, taxRate,
          0, isPreOrder, sellerType, isShopeeInvoice,
          isPromo,
          opExpenseRate, marketingRate
        );

        return { ...res, finalPrice: calculatedPrice, isImpossible };
      }, [
        price, cost, transFeeRate, serviceFeeRate, paymentFeeRate, taxRate,
        isPreOrder, isPromo, mode, targetMargin, sellerType, isShopeeInvoice,
        opExpenseRate, marketingRate
      ]);

      const comparisonResults = useMemo(() => {
        const c = parseFloat(cost) || 0;
        if (c <= 0) return { hasData: false };

        const scheme2Fixed = 60;

        const scheme1ServiceRate = (() => {
          let rate = 0;
          rate += 6.0;
          if (ccbType === '10') rate += (3.0 - 0.5);
          else if (ccbType === '5') rate += 1.5;
          return rate;
        })();

        const scheme2ServiceRate = (() => {
          let rate = 0;
          if (ccbType === '10') rate += 3.0;
          else if (ccbType === '5') rate += 1.5;
          return rate;
        })();

        const tMargin = parseFloat(targetMargin) || 30;

        const build = (name, serviceRate, scheme2Fee) => {
          const suggestP = calculatePriceReverse(
            tMargin, c,
            transFeeRate, serviceRate, paymentFeeRate, taxRate,
            scheme2Fee, isPreOrder, sellerType, isShopeeInvoice,
            isPromo,
            opExpenseRate, marketingRate
          );

          const stats = calculateScenario(
            suggestP, c, 1,
            transFeeRate, serviceRate, paymentFeeRate, taxRate,
            scheme2Fee, isPreOrder, sellerType, isShopeeInvoice,
            isPromo,
            opExpenseRate, marketingRate
          );

          return { ...stats, suggestedPrice: suggestP, name };
        };

        const scheme1 = build('å…é‹æ–¹æ¡ˆä¸€ (åƒåŠ FSS)', scheme1ServiceRate, 0);
        const scheme2 = build('å…é‹æ–¹æ¡ˆäºŒ (è‡ªè¡Œå¸æ”¶é‹è²»)', scheme2ServiceRate, scheme2Fixed);

        const best = (scheme1.suggestedPrice > 0 && scheme1.suggestedPrice <= scheme2.suggestedPrice) ? 'scheme1' : 'scheme2';

        return { hasData: true, scheme1, scheme2, best, scheme2Fixed };
      }, [
        cost, sellerType, ccbType, transFeeRate, paymentFeeRate, taxRate,
        isPreOrder, isPromo, isShopeeInvoice, targetMargin, opExpenseRate, marketingRate
      ]);

      const handleFocus = (e) => e.target.select();

      const ResultCard = ({ data, isBest, targetMargin }) => (
        <div className={`relative p-4 rounded-lg border-2 transition-all flex flex-col ${isBest ? 'border-shopee bg-orange-50 shadow-md' : 'border-gray-200 bg-white'}`}>
          {isBest && <div className="absolute -top-3 -right-2 bg-shopee text-white text-xs font-bold px-2 py-1 rounded shadow">ğŸ† å®šåƒ¹æ›´å„ª</div>}

          <div className="font-bold text-gray-800 text-lg mb-2">{data.name}</div>

          <div className="mb-3">
            <div className="text-xs text-gray-500 mb-1">å»ºè­°å”®åƒ¹ (ç›®æ¨™ ç‡Ÿæ¥­åˆ©æ½¤ç‡ {targetMargin}%)</div>
            <div className="text-2xl font-bold text-shopee">${data.suggestedPrice > 0 ? data.suggestedPrice.toLocaleString() : '-'}</div>
          </div>

          <div className="text-sm text-gray-600 space-y-1 bg-white/60 p-2 rounded border border-gray-100">
            <div className="flex justify-between text-gray-500"><span>- æˆäº¤æ‰‹çºŒè²»</span><span>-${data.transFee.toLocaleString()}</span></div>
            <div className="flex justify-between text-gray-500"><span>- æ´»å‹•æœå‹™è²»</span><span>-${data.serviceFee.toLocaleString()}</span></div>
            <div className="flex justify-between text-gray-500"><span>- é‡‘æµæœå‹™è²»</span><span>-${data.paymentFee.toLocaleString()}</span></div>
            {data.taxAmount > 0 && <div className="flex justify-between text-gray-500"><span>- ç¨…é‡‘</span><span>-${data.taxAmount.toLocaleString()}</span></div>}
            {data.sellerExtraShippingCost > 0 && <div className="flex justify-between text-gray-500"><span>- é‹è²»å¸æ”¶</span><span>-${data.sellerExtraShippingCost.toLocaleString()}</span></div>}
            {(data.opExp > 0 || data.mktExp > 0) && (
              <>
                <div className="flex justify-between text-gray-500"><span>- ç¶“ç‡Ÿè²»ç”¨</span><span>-${data.opExp.toLocaleString()}</span></div>
                <div className="flex justify-between text-gray-500"><span>- è¡ŒéŠ·è²»ç”¨</span><span>-${data.mktExp.toLocaleString()}</span></div>
              </>
            )}
            <div className="border-t border-dashed my-1 pt-1 flex justify-between items-center text-gray-800">
              <span className="font-medium">é ä¼°ç‡Ÿæ¥­ç²åˆ©</span>
              <span className="font-bold">${data.operatingProfit.toLocaleString()}</span>
            </div>
          </div>
        </div>
      );

      const promoAddForUI = useMemo(() => {
        if (!isPromo) return 0;
        return sellerType === 'mall' ? 3.0 : 2.0;
      }, [isPromo, sellerType]);

      return (
        <div className="min-h-screen pb-10">
          {/* Header */}
          <div className="bg-shopee text-white p-4 shadow-md sticky top-0 z-10">
            <div className="max-w-2xl mx-auto flex items-center justify-between">
              <h1 className="text-xl font-bold flex items-center gap-2">
                <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19.9 5.5c-.3-.8-1.4-1.2-2.1-.8l-2.6 1.3-2.6-1.3c-.7-.4-1.8 0-2.1.8l-1.6 3.8-3.8 1.6c-.8.3-1.2 1.4-.8 2.1l1.3 2.6-1.3 2.6c-.4.7 0 1.8.8 2.1l3.8 1.6 1.6 3.8c.3.8 1.4 1.2 2.1.8l2.6-1.3 2.6 1.3c.7.4 1.8 0 2.1-.8l1.6-3.8 3.8-1.6c.8-.3 1.2-1.4.8-2.1l-1.3-2.6 1.3-2.6c.4-.7 0-1.8-.8-2.1l-3.8-1.6-1.6-3.8z"/>
                </svg>
                è¦çš®æ‰‹çºŒè²»è¨ˆç®—æ©Ÿ
              </h1>
              <span className="text-xs bg-white/20 px-2 py-1 rounded">2026 å°ˆæ¥­ç‰ˆ</span>
            </div>
          </div>

          {/* HERO */}
          <div className="bg-gray-50">
            <div className="max-w-2xl mx-auto px-4 pt-4">
              <div className="relative overflow-hidden rounded-xl border border-gray-200 shadow-sm bg-gray-200">
                {heroOk ? (
                  <img
                    src="./hero.jpg"
                    alt="Hero banner"
                    className="w-full max-h-[200px] sm:max-h-[240px] object-contain bg-gray-200 block"
                    loading="eager"
                    onError={() => setHeroOk(false)}
                  />
                ) : (
                  <div className="h-[160px] flex items-center justify-center text-gray-400">åœ–ç‰‡ç„¡æ³•è¼‰å…¥</div>
                )}
              </div>
            </div>
          </div>

          <div className="max-w-2xl mx-auto p-4 space-y-6">
            {/* Mode tabs */}
            <div className="bg-white rounded-lg shadow-sm border border-gray-100 p-1 flex">
              <button
                onClick={() => setMode('profit')}
                className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${mode === 'profit' ? 'bg-orange-100 text-shopee shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}
              >
                ç”¨å”®åƒ¹ç®—ç²åˆ©
              </button>
              <button
                onClick={() => setMode('price')}
                className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${mode === 'price' ? 'bg-orange-100 text-shopee shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}
              >
                ç”¨ç‡Ÿæ¥­åˆ©æ½¤ç‡ç®—å”®åƒ¹
              </button>
            </div>

            {/* Inputs */}
            <div className="bg-white rounded-lg shadow-sm border border-gray-100 p-5">
              <h2 className="text-lg font-semibold text-gray-700 mb-4 border-l-4 border-shopee pl-3">å•†å“è³‡è¨Š</h2>

              <div className="grid grid-cols-2 gap-4">
                {mode === 'profit' ? (
                  <div className="col-span-2 sm:col-span-1">
                    <label className="block text-sm font-medium text-gray-600 mb-1">å•†å“å”®åƒ¹ (å–®ä»¶)</label>
                    <div className="relative">
                      <span className="absolute left-3 top-2.5 text-gray-400">$</span>
                      <input
                        type="number"
                        inputMode="decimal"
                        value={price}
                        onChange={(e) => setPrice(e.target.value)}
                        onFocus={handleFocus}
                        className="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all text-lg font-medium"
                        placeholder="0"
                      />
                    </div>
                  </div>
                ) : (
                  <div className="col-span-2 sm:col-span-1">
                    <label className="block text-sm font-medium text-gray-600 mb-1">ç›®æ¨™ç‡Ÿæ¥­åˆ©æ½¤ç‡</label>
                    <div className="relative">
                      <input
                        type="number"
                        inputMode="decimal"
                        value={targetMargin}
                        onChange={(e) => setTargetMargin(e.target.value)}
                        onFocus={handleFocus}
                        className="w-full pl-3 pr-8 py-2 border-2 border-orange-200 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all text-lg font-medium text-shopee"
                        placeholder="30"
                      />
                      <span className="absolute right-3 top-2.5 text-gray-400 font-bold">%</span>
                    </div>
                  </div>
                )}

                <div className="col-span-2 sm:col-span-1">
                  <label className="block text-sm font-medium text-gray-600 mb-1">å•†å“æˆæœ¬</label>
                  <div className="relative">
                    <span className="absolute left-3 top-2.5 text-gray-400">$</span>
                    <input
                      type="number"
                      inputMode="decimal"
                      value={cost}
                      onChange={(e) => setCost(e.target.value)}
                      onFocus={handleFocus}
                      className={`w-full pl-7 pr-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all ${mode === 'price' && !cost ? 'border-red-300 bg-red-50' : 'border-gray-300'}`}
                      placeholder="0"
                    />
                  </div>
                </div>

                <div className="col-span-2 sm:col-span-1">
                  <label className="block text-sm font-medium text-gray-600 mb-1">ç¶“ç‡Ÿè²»ç”¨ä½”æ¯”</label>
                  <div className="relative">
                    <input
                      type="number"
                      inputMode="decimal"
                      value={opExpenseRate}
                      onChange={(e)=>setOpExpenseRate(e.target.value)}
                      onFocus={handleFocus}
                      className="w-full pl-3 pr-8 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all"
                      placeholder="0"
                    />
                    <span className="absolute right-3 top-2.5 text-gray-400 font-bold">%</span>
                  </div>
                </div>

                <div className="col-span-2 sm:col-span-1">
                  <label className="block text-sm font-medium text-gray-600 mb-1">è¡ŒéŠ·è²»ç”¨ä½”æ¯”</label>
                  <div className="relative">
                    <input
                      type="number"
                      inputMode="decimal"
                      value={marketingRate}
                      onChange={(e)=>setMarketingRate(e.target.value)}
                      onFocus={handleFocus}
                      className="w-full pl-3 pr-8 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all"
                      placeholder="0"
                    />
                    <span className="absolute right-3 top-2.5 text-gray-400 font-bold">%</span>
                  </div>
                </div>
              </div>

              <div className="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200 text-xs text-gray-600 leading-relaxed">
                <div className="font-bold text-gray-700 mb-1">å…¬å¼å°è²¼å£«</div>
                <div>ç‡Ÿæ¥­åˆ©æ½¤ç‡ = (é ä¼°ç‡Ÿæ¥­ç²åˆ© Ã· å”®åƒ¹) Ã— 100%</div>
                <div>é ä¼°ç‡Ÿæ¥­ç²åˆ© = å”®åƒ¹ âˆ’(æˆäº¤æ‰‹çºŒè²»+æ´»å‹•æœå‹™è²»+é‡‘æµè²»+ç¨…é‡‘+é‹è²»å¸æ”¶) âˆ’ å•†å“æˆæœ¬ âˆ’ ç¶“ç‡Ÿè²»ç”¨ âˆ’ è¡ŒéŠ·è²»ç”¨</div>
              </div>
            </div>

            {/* Settings */}
            <div className="bg-white rounded-lg shadow-sm border border-gray-100 p-5">
              <h2 className="text-lg font-semibold text-gray-700 mb-4 border-l-4 border-shopee pl-3">è²»ç‡è¨­å®š</h2>

              <div className="mb-6 p-3 bg-blue-50 rounded-lg border border-blue-100">
                <label className="text-sm font-bold text-blue-800 mb-2 block">è³£å ´é¡å‹</label>
                <div className="flex gap-2">
                  <button
                    onClick={() => setSellerType('general')}
                    className={`flex-1 py-1.5 px-3 rounded text-sm transition-colors border ${sellerType === 'general' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                  >
                    ä¸€èˆ¬è³£å®¶ (æœ‰ä¸Šé™)
                  </button>
                  <button
                    onClick={() => setSellerType('mall')}
                    className={`flex-1 py-1.5 px-3 rounded text-sm transition-colors border ${sellerType === 'mall' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                  >
                    å•†åŸ/å…¶ä»– (ç„¡ä¸Šé™)
                  </button>
                </div>

                <div className="mt-3">
                  <label className="text-xs text-blue-900 font-bold block mb-1 flex items-center">
                    æˆäº¤æ‰‹çºŒè²»ï¼ˆåŸºç¤ï¼Œå¯æ‰‹å‹•ä¿®æ”¹ï¼‰
                    {/* âœ… æˆäº¤æ‰‹çºŒè²»å®˜æ–¹é€£çµ */}
                    <InfoLink
                      href="https://seller.shopee.tw/edu/article/26470"
                      label="æŸ¥çœ‹è¦çš®å®˜æ–¹ï¼šæˆäº¤æ‰‹çºŒè²»èªªæ˜"
                    />
                  </label>
                  <div className="flex items-center gap-2">
                    <input
                      type="number"
                      inputMode="decimal"
                      value={transFeeRate}
                      onChange={(e) => setTransFeeRate(Number(e.target.value))}
                      className="w-28 px-2 py-1.5 border border-blue-200 rounded-md text-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#ee4d2d]"
                    />
                    <span className="text-sm text-blue-900">%</span>
                    <span className="text-xs text-blue-700">
                      é è¨­ï¼šä¸€èˆ¬ 6.5%ã€å•†åŸ 9%
                    </span>
                  </div>
                </div>
              </div>

              <div className="space-y-5">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">æª”æœŸè¨­å®š</label>
                  <div className="flex flex-wrap gap-2">
                    <button
                      onClick={() => setIsPromo(false)}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${!isPromo ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      éæª”æœŸ (ä¸€èˆ¬æ—¥)
                    </button>
                    <button
                      onClick={() => setIsPromo(true)}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${isPromo ? 'bg-orange-500 text-white border-orange-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      ğŸ”¥ ä¿ƒéŠ·æª”æœŸ / æ´»å‹•æ—¥
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">å…é‹æ–¹æ¡ˆ (FSS)</label>
                  <div className="flex flex-wrap gap-2">
                    <button
                      onClick={() => setIsFSS(false)}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${!isFSS ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      æœªåƒåŠ 
                    </button>
                    <button
                      onClick={() => setIsFSS(true)}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${isFSS ? 'bg-green-600 text-white border-green-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      åƒåŠ å…é‹æ–¹æ¡ˆ (æ´»å‹•è²» 6%)
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                    è¦å¹£å›é¥‹ (CCB)
                    {/* âœ… è¦å¹£å›é¥‹å®˜æ–¹é€£çµ */}
                    <InfoLink
                      href="https://help.shopee.tw/portal/4/article/139826-[%E6%A2%9D%E6%AC%BE%E8%88%87%E6%94%BF%E7%AD%96]-%E8%9D%A6%E5%B9%A3%E5%9B%9E%E9%A5%8B%E6%96%B9%E6%A1%88%E7%B4%84%E5%AE%9A%E6%A2%9D%E6%AC%BE"
                      label="æŸ¥çœ‹è¦çš®å®˜æ–¹ï¼šè¦å¹£å›é¥‹æ–¹æ¡ˆæ¢æ¬¾èˆ‡æ”¿ç­–"
                    />
                  </label>
                  <div className="flex flex-wrap gap-2">
                    <button
                      onClick={() => setCcbType('none')}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${ccbType === 'none' ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      ä¸åƒåŠ 
                    </button>
                    <button
                      onClick={() => setCcbType('10')}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${ccbType === '10' ? 'bg-yellow-500 text-white border-yellow-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      10%å›é¥‹ {isFSS ? '(2.5%)' : '(3%)'}
                    </button>
                    <button
                      onClick={() => setCcbType('5')}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${ccbType === '5' ? 'bg-yellow-400 text-white border-yellow-400 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      5%å›é¥‹ (1.5%)
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">å‡ºè²¨å¤©æ•¸</label>
                  <div className="flex flex-wrap gap-2">
                    <button
                      onClick={() => setIsPreOrder(false)}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${!isPreOrder ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      âš¡ å¿«é€Ÿå‡ºè²¨
                    </button>
                    <button
                      onClick={() => setIsPreOrder(true)}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${isPreOrder ? 'bg-red-500 text-white border-red-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      è¼ƒé•·å‚™è²¨ (+3%æˆäº¤æ‰‹çºŒè²»)
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">ç™¼ç¥¨ç¨…ç‡</label>
                  <div className="flex flex-wrap gap-2 items-center">
                    <button
                      onClick={() => handleTaxSelection('0')}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${taxRate === 0 ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      ä¸é–‹ç™¼ç¥¨ (0%)
                    </button>
                    <button
                      onClick={() => handleTaxSelection('1')}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${taxRate === 1 ? 'bg-blue-500 text-white border-blue-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      ç¨…ç± (1%)
                    </button>
                    <button
                      onClick={() => handleTaxSelection('5')}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${taxRate === 5 && !isShopeeInvoice ? 'bg-blue-600 text-white border-blue-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      ç™¼ç¥¨ (5%)
                    </button>
                    <button
                      onClick={() => handleTaxSelection('shopee')}
                      className={`px-4 py-2 rounded-lg text-sm border transition-all ${isShopeeInvoice ? 'bg-purple-600 text-white border-purple-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                    >
                      è¦çš®ä»£é–‹ (5%+$2.5)
                    </button>

                    <div className="relative w-24">
                      <input
                        type="number"
                        value={taxRate}
                        onChange={(e) => setTaxRate(Number(e.target.value))}
                        className="w-full pl-2 pr-6 py-2 border border-gray-300 rounded-lg text-sm text-center focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none"
                      />
                      <span className="absolute right-2 top-2 text-gray-500 text-xs">%</span>
                    </div>
                  </div>
                </div>
              </div>

              <div className="mt-6 pt-4 border-t border-gray-100 grid grid-cols-2 sm:grid-cols-4 gap-4 text-xs text-gray-500 bg-gray-50 p-3 rounded-lg">
                <div>
                  <div className="mb-1">æˆäº¤æ‰‹çºŒè²»ï¼ˆå¯¦éš›ï¼‰</div>
                  <div className="font-mono font-medium text-gray-700 text-base">
                    {transFeeRate}%{isPromo ? `+${promoAddForUI}%` : ''}{isPreOrder ? '+3%' : ''}
                  </div>
                </div>
                <div>
                  <div className="mb-1">æ´»å‹•æœå‹™è²»</div>
                  <div className="font-mono font-medium text-gray-700 text-base">{serviceFeeRate}%</div>
                </div>
                <div>
                  <div className="mb-1">é‡‘æµæœå‹™è²»</div>
                  <div className="font-mono font-medium text-gray-700 text-base">{paymentFeeRate}%</div>
                </div>
                <div>
                  <div className="mb-1">ç¨…ç‡</div>
                  <div className="font-mono font-medium text-gray-700 text-base">{taxRate}% {isShopeeInvoice && <span className="text-purple-600">+$3</span>}</div>
                </div>
              </div>
            </div>

            {/* Main results */}
            <div className={`bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden ${mainResults.isImpossible ? 'opacity-70' : ''}`}>
              <div className={`p-4 border-b border-gray-200 flex justify-between items-center ${mode === 'price' ? 'bg-orange-50' : 'bg-gray-50'}`}>
                <h2 className="font-bold text-gray-700 flex items-center">{mode === 'price' && <span className="mr-2 text-lg">ğŸ¯</span>}è©¦ç®—çµæœ (ä¾ä¸Šæ–¹è¨­å®š)</h2>
                <div className="text-sm text-gray-500">
                  {mode === 'price' ? 'ç›®æ¨™: ' + targetMargin + '% ç‡Ÿæ¥­åˆ©æ½¤ç‡' : 'éŠ·å”®ç¸½é¡: $' + mainResults.totalSales.toLocaleString()}
                </div>
              </div>

              {mainResults.isImpossible ? (
                <div className="p-8 text-center text-red-500 font-bold">
                  <div className="text-2xl mb-2">âš ï¸ ç„¡æ³•è¨ˆç®—</div>
                  <p className="text-sm text-gray-600">è²»ç”¨å·²è¶…é 100%</p>
                </div>
              ) : (
                <div className="p-5 space-y-3">
                  {mode === 'price' && (
                    <div className="mb-6 text-center border-b pb-5 border-dashed border-gray-300">
                      <p className="text-sm text-gray-500 mb-1">å»ºè­°æœ€å°‘å”®åƒ¹</p>
                      <div className="text-4xl font-extrabold text-shopee">${mainResults.finalPrice.toLocaleString()}</div>
                      <p className="text-xs text-gray-400 mt-2">é ä¼°ç‡Ÿæ¥­ç²åˆ© ${mainResults.operatingProfit.toLocaleString()}</p>
                    </div>
                  )}

                  <div className="flex justify-between items-center text-sm text-gray-600">
                    <span className="flex items-center">
                      æˆäº¤æ‰‹çºŒè²»
                      {mainResults.capApplied && <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-1 rounded">ä¸Šé™</span>}
                    </span>
                    <span>-${mainResults.transFee.toLocaleString()}</span>
                  </div>

                  <div className="flex justify-between items-center text-sm text-gray-600"><span>æ´»å‹•æœå‹™è²»</span><span>-${mainResults.serviceFee.toLocaleString()}</span></div>
                  <div className="flex justify-between items-center text-sm text-gray-600"><span>é‡‘æµæœå‹™è²»</span><span>-${mainResults.paymentFee.toLocaleString()}</span></div>
                  {mainResults.taxAmount > 0 && (
                    <div className="flex justify-between items-center text-sm text-gray-600">
                      <span>ç¨…é‡‘ {mainResults.shopeeInvoiceFee > 0 ? '(å«ä»£é–‹è²»)' : ''}</span>
                      <span>-${mainResults.taxAmount.toLocaleString()}</span>
                    </div>
                  )}

                  {(mainResults.opExp > 0 || mainResults.mktExp > 0) && (
                    <>
                      <div className="flex justify-between items-center text-sm text-gray-600"><span>ç¶“ç‡Ÿè²»ç”¨</span><span>-${mainResults.opExp.toLocaleString()}</span></div>
                      <div className="flex justify-between items-center text-sm text-gray-600"><span>è¡ŒéŠ·è²»ç”¨</span><span>-${mainResults.mktExp.toLocaleString()}</span></div>
                    </>
                  )}

                  <div className="h-px bg-gray-200 my-2"></div>

                  <div className="flex justify-between items-center font-medium text-red-500">
                    <span>è²»ç”¨ç¸½è¨ˆ</span>
                    <span>-${mainResults.totalFees.toLocaleString()}</span>
                  </div>

                  <div className="mt-4 bg-orange-50 rounded-lg p-4 border border-orange-100 flex justify-between items-center">
                    <span className="text-gray-600 font-medium">é ä¼°ç‡Ÿæ¥­ç²åˆ©</span>
                    <div className="text-right">
                      <div className="text-2xl font-bold text-shopee">${mainResults.operatingProfit.toLocaleString()}</div>
                      <div className="text-xs text-gray-500">ç‡Ÿæ¥­åˆ©æ½¤ç‡: {mainResults.operatingMargin.toFixed(1)}%</div>
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* Comparison */}
            <div className="bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden mt-8">
              <div className="bg-gray-800 text-white p-4 flex justify-between items-center">
                <h2 className="font-bold flex items-center text-lg"><span className="mr-2">ğŸ“Š</span> ç²åˆ©ç¸½è¦½èˆ‡ç­–ç•¥åˆ†æ</h2>
                <span className="text-xs bg-gray-700 px-2 py-1 rounded text-gray-300">åªæ¯”è¼ƒï¼šæ–¹æ¡ˆä¸€ vs æ–¹æ¡ˆäºŒ</span>
              </div>

              {!comparisonResults.hasData ? (
                <div className="p-10 text-center text-gray-400">
                  <div className="text-4xl mb-3">ğŸ”¢</div>
                  <p>è«‹è¼¸å…¥å•†å“æˆæœ¬ä»¥æŸ¥çœ‹ç­–ç•¥åˆ†æçµæœ</p>
                </div>
              ) : (
                <div className="p-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <ResultCard data={comparisonResults.scheme1} isBest={comparisonResults.best === 'scheme1'} targetMargin={targetMargin} />
                  <ResultCard data={comparisonResults.scheme2} isBest={comparisonResults.best === 'scheme2'} targetMargin={targetMargin} />
                </div>
              )}
            </div>

            {/* Social */}
            <div className="mt-8 flex justify-center gap-6 pb-8">
              <a href="https://www.youtube.com/@hana31923" target="_blank" rel="noopener noreferrer"
                 className="text-gray-400 hover:text-red-600 transition-colors transform hover:scale-110">
                <YouTubeIcon />
              </a>
              <a href="https://www.instagram.com/hana20200916/" target="_blank" rel="noopener noreferrer"
                 className="text-gray-400 hover:text-pink-600 transition-colors transform hover:scale-110">
                <InstagramIcon />
              </a>
            </div>

          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Calculator />);
  </script>
</body>
</html>
