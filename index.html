<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦çš®æ‰‹çºŒè²»åˆ©æ½¤è¨ˆç®—æ©Ÿ (2026 å°ˆæ¥­ç‰ˆ)</title>
    <!-- React Production Build for better performance -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Shopee Colors -->
    <style>
        .text-shopee { color: #ee4d2d; }
        .bg-shopee { background-color: #ee4d2d; }
        .bg-shopee-dark { background-color: #d73211; }
        .border-shopee { border-color: #ee4d2d; }
        .focus-ring-shopee:focus { --tw-ring-color: #ee4d2d; }

        /* Custom scrollbar for cleaner look */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #ee4d2d; }

        /* Tab transitions */
        .tab-content { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Icons
        const InfoIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline-block ml-1 text-gray-400 cursor-help"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
        );

        const Calculator = () => {
            // --- State ---
            const [mode, setMode] = useState('profit'); // 'profit' or 'price'
            const [sellerType, setSellerType] = useState('general'); // 'general' or 'mall'

            // Basic Inputs
            const [price, setPrice] = useState('');
            const [targetMargin, setTargetMargin] = useState('20');
            const [cost, setCost] = useState('');
            
            // Image Fallback State
            const [heroOk, setHeroOk] = useState(true);

            // Rates (Manual Inputs for Top Section)
            const [transFeeRate, setTransFeeRate] = useState(6);
            const [serviceFeeRate, setServiceFeeRate] = useState(0);
            const [paymentFeeRate, setPaymentFeeRate] = useState(2.5);
            const [taxRate, setTaxRate] = useState(0);

            // New State for Shopee E-Invoice
            const [isShopeeInvoice, setIsShopeeInvoice] = useState(false);

            // Comparison Settings (Defaults)
            const [compShippingCost, setCompShippingCost] = useState('60');
            const [compFSSRate, setCompFSSRate] = useState('6');

            // Toggles
            const [isPromo, setIsPromo] = useState(false);
            const [isFSS, setIsFSS] = useState(false);
            const [ccbType, setCcbType] = useState('none'); // 'none', '10', '5'
            const [isPreOrder, setIsPreOrder] = useState(false);

            // --- Effects ---

            // 1. Transaction Fee Logic
            useEffect(() => {
                let baseRate = 6;
                if (isPromo) baseRate = 7.5;
                setTransFeeRate(baseRate);
            }, [isPromo]);

            // 2. Service Fee Logic (FSS + CCB Combination)
            useEffect(() => {
                let sRate = 0;

                // FSS Base
                if (isFSS) sRate += 6.0;

                // CCB Logic
                if (ccbType === '10') {
                    // 10% CCB Base is 3%
                    let ccbRate = 3.0;
                    // Discount logic: If FSS is active, 10% CCB gets 0.5% discount -> 2.5%
                    if (isFSS) ccbRate -= 0.5;
                    sRate += ccbRate;
                } else if (ccbType === '5') {
                    // 5% CCB is 1.5%
                    sRate += 1.5;
                }

                setServiceFeeRate(sRate);
            }, [isFSS, ccbType]);

            // Helper to set tax easily
            const handleTaxSelection = (type) => {
                if (type === '0') {
                    setTaxRate(0);
                    setIsShopeeInvoice(false);
                } else if (type === '1') {
                    setTaxRate(1);
                    setIsShopeeInvoice(false);
                } else if (type === '5') {
                    setTaxRate(5);
                    setIsShopeeInvoice(false);
                } else if (type === 'shopee') {
                    setTaxRate(5);
                    setIsShopeeInvoice(true);
                }
            };

            // --- Core Logic ---

            const calculateScenario = (
                p, c, s_paid_by_buyer, q,
                r_trans_percent, r_serv_percent, r_pay_percent, r_tax_percent,
                scheme2_fee,
                is_pre_order, s_type,
                use_shopee_invoice
            ) => {
                const numP = parseFloat(p) || 0;
                const numQ = parseFloat(q) || 1;
                const totalSales = numP * numQ;

                // 1. Transaction Fee
                let effectiveTransRate = parseFloat(r_trans_percent) || 0;
                if (is_pre_order) effectiveTransRate += 3.0;

                let transFeeBase = totalSales;
                let capApplied = false;
                if (s_type === 'general') {
                    const cappedItemPrice = Math.min(numP, 35000);
                    if (numP > 35000) capApplied = true;
                    transFeeBase = cappedItemPrice * numQ;
                }
                const transFee = Math.round(transFeeBase * (effectiveTransRate / 100));

                // 2. Service Fee
                const serviceFee = Math.round(totalSales * ((parseFloat(r_serv_percent) || 0) / 100));

                // 3. Payment Fee
                const paymentFeeBase = totalSales + (parseFloat(s_paid_by_buyer) || 0);
                const paymentFee = Math.round(paymentFeeBase * ((parseFloat(r_pay_percent) || 0) / 100));

                // 4. Tax
                const baseTaxAmount = Math.round(totalSales * ((parseFloat(r_tax_percent) || 0) / 100));
                const shopeeInvoiceFee = use_shopee_invoice ? 3 : 0;
                const taxAmount = baseTaxAmount + shopeeInvoiceFee;

                // 5. Scheme 2 Fee
                const scheme2Cost = scheme2_fee > 0 ? parseFloat(scheme2_fee) : 0;

                // Results
                const totalFees = transFee + serviceFee + paymentFee + taxAmount + scheme2Cost;
                const income = totalSales - transFee - serviceFee - paymentFee - scheme2Cost;
                const profit = income - ((parseFloat(c) || 0) * numQ) - taxAmount;

                const profitMargin = totalSales > 0 ? (profit / totalSales) * 100 : 0;

                return {
                    transFee, serviceFee, paymentFee, taxAmount,
                    sellerExtraShippingCost: scheme2Cost,
                    totalFees, profit, profitMargin, totalSales, capApplied, shopeeInvoiceFee
                };
            };

            const calculatePriceReverse = (
                targetMarginPercent, c, q, s_paid_by_buyer,
                r_trans_percent, r_serv_percent, r_pay_percent, r_tax_percent,
                scheme2_fee, is_pre_order, s_type, use_shopee_invoice
            ) => {
                if (!c || parseFloat(c) <= 0) return 0;
                const costVal = parseFloat(c);

                let min = costVal;
                let max = costVal * 10 + 200000;
                let bestPrice = max;
                let iterations = 25;

                for (let i = 0; i < iterations; i++) {
                    let mid = (min + max) / 2;
                    let testPrice = Math.ceil(mid);

                    const res = calculateScenario(
                        testPrice, c, s_paid_by_buyer, q,
                        r_trans_percent, r_serv_percent, r_pay_percent, r_tax_percent,
                        scheme2_fee, is_pre_order, s_type, use_shopee_invoice
                    );

                    if (res.profitMargin < targetMarginPercent) {
                        min = mid;
                    } else {
                        bestPrice = testPrice;
                        max = mid;
                    }
                }
                return bestPrice;
            };

            // --- Main Calculations ---
            const mainResults = useMemo(() => {
                // Fixed constants for simplified UI
                const shipping = 0;
                const quantity = 1;

                let calculatedPrice = parseFloat(price) || 0;
                let isImpossible = false;

                if (mode === 'price') {
                    calculatedPrice = calculatePriceReverse(
                        parseFloat(targetMargin)||0, cost, quantity, shipping,
                        transFeeRate, serviceFeeRate, paymentFeeRate, taxRate,
                        0, isPreOrder, sellerType, isShopeeInvoice
                    );
                    if (calculatedPrice <= 0 && (parseFloat(targetMargin)||0) > 0) isImpossible = true;
                }

                const res = calculateScenario(
                    calculatedPrice, cost, shipping, quantity,
                    transFeeRate, serviceFeeRate, paymentFeeRate, taxRate,
                    0, isPreOrder, sellerType, isShopeeInvoice
                );

                return { ...res, finalPrice: calculatedPrice, isImpossible };

            }, [price, cost, transFeeRate, serviceFeeRate, paymentFeeRate, taxRate, isPreOrder, mode, targetMargin, sellerType, isShopeeInvoice]);

            // --- Comparison Calculations ---
            const comparisonResults = useMemo(() => {
                const c = parseFloat(cost) || 0;
                const hasData = c > 0;
                if (!hasData) return { hasData: false };

                const q = 1; // Fixed quantity 1
                const s_scheme2_val = compShippingCost;
                const fss_scheme1_rate = compFSSRate;
                const tMargin = parseFloat(targetMargin) || 20;

                const normalTransRate = 6;
                const promoTransRate = 7.5;
                const payRate = 2.5;
                const tRate = taxRate;
                const useShopeeInv = isShopeeInvoice;

                const getServiceRate = (hasFSS) => {
                    let rate = 0;
                    if (hasFSS) rate += parseFloat(fss_scheme1_rate) || 6;
                    let effectiveCCB = 0;
                    if (ccbType === '10') effectiveCCB = 3.0;
                    if (ccbType === '5') effectiveCCB = 1.5;
                    if (hasFSS && ccbType === '10') effectiveCCB -= 0.5;
                    rate += effectiveCCB;
                    return rate;
                };

                const buildScenarioResult = (name, transR, hasFSS, scheme2Fee) => {
                    const servR = getServiceRate(hasFSS);

                    const suggestP = calculatePriceReverse(
                        tMargin, c, q, 0,
                        transR, servR, payRate, tRate,
                        scheme2Fee, isPreOrder, sellerType, useShopeeInv
                    );

                    const stats = calculateScenario(
                        suggestP, c, 0, q,
                        transR, servR, payRate, tRate,
                        scheme2Fee, isPreOrder, sellerType, useShopeeInv
                    );

                    return { ...stats, suggestedPrice: suggestP, name };
                };

                const gen_fss = buildScenarioResult('å…é‹æ–¹æ¡ˆä¸€ (åƒåŠ FSS)', normalTransRate, true, 0);
                const gen_scheme2 = buildScenarioResult('å…é‹æ–¹æ¡ˆäºŒ (å®šé¡$60)', normalTransRate, false, s_scheme2_val);

                const promo_fss = buildScenarioResult('å…é‹æ–¹æ¡ˆä¸€ (åƒåŠ FSS)', promoTransRate, true, 0);
                const promo_scheme2 = buildScenarioResult('å…é‹æ–¹æ¡ˆäºŒ (å®šé¡$60)', promoTransRate, false, s_scheme2_val);

                const validPrice = (p) => p > 0 ? p : Infinity;
                const minGenPrice = Math.min(validPrice(gen_fss.suggestedPrice), validPrice(gen_scheme2.suggestedPrice));
                const minPromoPrice = Math.min(validPrice(promo_fss.suggestedPrice), validPrice(promo_scheme2.suggestedPrice));

                return {
                    gen_fss, gen_scheme2, promo_fss, promo_scheme2,
                    minGenPrice, minPromoPrice, hasData: true
                };

            }, [cost, taxRate, compShippingCost, compFSSRate, isPreOrder, sellerType, targetMargin, ccbType, isShopeeInvoice]);

            // --- Handlers ---
            const handleFocus = (e) => e.target.select();

            // --- Component: Result Card ---
            const ResultCard = ({ data, isBest, title, badge }) => (
                <div className={`relative p-4 rounded-lg border-2 transition-all flex flex-col ${isBest ? 'border-shopee bg-orange-50 shadow-md' : 'border-gray-200 bg-white'}`}>
                    {isBest && <div className="absolute -top-3 -right-2 bg-shopee text-white text-xs font-bold px-2 py-1 rounded shadow">ğŸ† å®šåƒ¹æ›´å„ª</div>}

                    <div className="flex justify-between items-start mb-3">
                        <div>
                            <div className="font-bold text-gray-800 text-lg">{title}</div>
                            {badge}
                        </div>
                    </div>

                    <div className="mb-3">
                        <div className="text-xs text-gray-500 mb-1">å»ºè­°å”®åƒ¹ (æ¯›åˆ© {targetMargin}%)</div>
                        <div className="text-2xl font-bold text-shopee">${data.suggestedPrice > 0 ? data.suggestedPrice.toLocaleString() : '-'}</div>
                    </div>

                    <div className="text-sm text-gray-600 space-y-1 bg-white/60 p-2 rounded border border-gray-100">
                        <div className="flex justify-between text-gray-400 text-xs">
                            <span>- å•†å“æˆæœ¬</span>
                            <span>-${parseFloat(cost).toLocaleString()}</span>
                        </div>
                        {data.sellerExtraShippingCost > 0 && (
                            <div className="flex justify-between text-red-500 font-bold">
                                <span>- æ–¹æ¡ˆäºŒè²»ç”¨</span>
                                <span>-${data.sellerExtraShippingCost.toLocaleString()}</span>
                            </div>
                        )}
                        <div className="flex justify-between text-gray-500">
                            <span>- æˆäº¤/é‡‘æµè²»</span>
                            <span>-${(data.transFee + data.paymentFee).toLocaleString()}</span>
                        </div>
                        {data.serviceFee > 0 && (
                            <div className="flex justify-between text-blue-600 font-medium">
                                <span>- æ´»å‹•æœå‹™è²» (FSS/CCB)</span>
                                <span>-${data.serviceFee.toLocaleString()}</span>
                            </div>
                        )}
                        {data.taxAmount > 0 && (
                            <div className="flex justify-between text-gray-400 text-xs">
                                <span>- ç¨…é‡‘ {data.shopeeInvoiceFee > 0 ? '(å«ä»£é–‹è²»)' : ''}</span>
                                <span>-${data.taxAmount.toLocaleString()}</span>
                            </div>
                        )}
                        <div className="border-t border-dashed my-1 pt-1 flex justify-between items-center text-gray-800">
                            <span className="font-medium">é ä¼°æ·¨åˆ©</span>
                            <span className="font-bold">${data.profit.toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pb-10">
                    {/* Header */}
                    <div className="bg-shopee text-white p-4 shadow-md sticky top-0 z-10">
                        <div className="max-w-2xl mx-auto flex items-center justify-between">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M19.9 5.5c-.3-.8-1.4-1.2-2.1-.8l-2.6 1.3-2.6-1.3c-.7-.4-1.8 0-2.1.8l-1.6 3.8-3.8 1.6c-.8.3-1.2 1.4-.8 2.1l1.3 2.6-1.3 2.6c-.4.7 0 1.8.8 2.1l3.8 1.6 1.6 3.8c.3.8 1.4 1.2 2.1.8l2.6-1.3 2.6 1.3c.7.4 1.8 0 2.1-.8l1.6-3.8 3.8-1.6c.8-.3 1.2-1.4.8-2.1l-1.3-2.6 1.3-2.6c.4-.7 0-1.8-.8-2.1l-3.8-1.6-1.6-3.8z"/></svg>
                                è¦çš®æ‰‹çºŒè²»è¨ˆç®—æ©Ÿ
                            </h1>
                            <span className="text-xs bg-white/20 px-2 py-1 rounded">2026 å°ˆæ¥­ç‰ˆ</span>
                        </div>
                    </div>

                    {/* HERO BANNER - ä¿®æ­£åœ–ç‰‡è£åˆ‡å•é¡Œ */}
                    <div className="bg-gray-50">
                        <div className="max-w-2xl mx-auto px-4 pt-4">
                            <div className="relative overflow-hidden rounded-xl border border-gray-200 shadow-sm bg-gray-200">
                                {/* ç§»é™¤é®ç½©ï¼Œå› ç‚ºé®ç½©åœ¨è‡ªå‹•é«˜åº¦ä¸‹å¯èƒ½æœƒè·‘ç‰ˆï¼Œä¸”åœ–ç‰‡éœ€è¦æ¸…æ™°å‘ˆç¾ */}
                                {/* é—œéµä¿®æ­£ï¼šclassName æ”¹ç‚º w-full h-auto (è‡ªç„¶å¯¬é«˜) */}
                                <img
                                    src="./hero.jpg"
                                    alt="Hero banner"
                                    className="w-full h-auto block"
                                    loading="eager"
                                    onError={() => setHeroOk(false)}
                                    style={{ minHeight: '100px', display: heroOk ? 'block' : 'none' }}
                                />
                                {!heroOk && (
                                    <div className="h-[160px] flex items-center justify-center text-gray-400">
                                        åœ–ç‰‡ç„¡æ³•è¼‰å…¥
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="max-w-2xl mx-auto p-4 space-y-6">

                        {/* Mode Switch Tabs */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-100 p-1 flex">
                            <button onClick={() => setMode('profit')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${mode === 'profit' ? 'bg-orange-100 text-shopee shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}>ç”¨å”®åƒ¹ç®—ç²åˆ©</button>
                            <button onClick={() => setMode('price')} className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${mode === 'price' ? 'bg-orange-100 text-shopee shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}>ç”¨åˆ©æ½¤ç‡ç®—å”®åƒ¹</button>
                        </div>

                        {/* 1. Input Section */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-100 p-5">
                            <h2 className="text-lg font-semibold text-gray-700 mb-4 border-l-4 border-shopee pl-3">å•†å“è³‡è¨Š</h2>
                            <div className="grid grid-cols-2 gap-4">
                                {mode === 'profit' ? (
                                    <div className="col-span-2 sm:col-span-1">
                                        <label className="block text-sm font-medium text-gray-600 mb-1">å•†å“å”®åƒ¹ (å–®ä»¶)</label>
                                        <div className="relative">
                                            <span className="absolute left-3 top-2.5 text-gray-400">$</span>
                                            <input type="number" inputMode="decimal" value={price} onChange={(e) => setPrice(e.target.value)} onFocus={handleFocus} className="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all text-lg font-medium" placeholder="0"/>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="col-span-2 sm:col-span-1">
                                        <label className="block text-sm font-medium text-gray-600 mb-1">ç›®æ¨™åˆ©æ½¤ç‡</label>
                                        <div className="relative">
                                            <input type="number" inputMode="decimal" value={targetMargin} onChange={(e) => setTargetMargin(e.target.value)} onFocus={handleFocus} className="w-full pl-3 pr-8 py-2 border-2 border-orange-200 rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all text-lg font-medium text-shopee" placeholder="20"/>
                                            <span className="absolute right-3 top-2.5 text-gray-400 font-bold">%</span>
                                        </div>
                                    </div>
                                )}
                                <div className="col-span-2 sm:col-span-1">
                                    <label className="block text-sm font-medium text-gray-600 mb-1">å•†å“æˆæœ¬</label>
                                    <div className="relative">
                                        <span className="absolute left-3 top-2.5 text-gray-400">$</span>
                                        <input type="number" inputMode="decimal" value={cost} onChange={(e) => setCost(e.target.value)} onFocus={handleFocus} className={`w-full pl-7 pr-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#ee4d2d] focus:border-transparent transition-all ${mode === 'price' && !cost ? 'border-red-300 bg-red-50' : 'border-gray-300'}`} placeholder="0"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* 2. Detailed Settings - Redesigned with Buttons */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-100 p-5">
                            <h2 className="text-lg font-semibold text-gray-700 mb-4 border-l-4 border-shopee pl-3">è²»ç‡è¨­å®š</h2>

                            <div className="mb-6 p-3 bg-blue-50 rounded-lg border border-blue-100">
                                <label className="text-sm font-bold text-blue-800 mb-2 block">è³£å ´é¡å‹</label>
                                <div className="flex gap-2">
                                    <button onClick={() => setSellerType('general')} className={`flex-1 py-1.5 px-3 rounded text-sm transition-colors border ${sellerType === 'general' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>ä¸€èˆ¬è³£å®¶ (æœ‰ä¸Šé™)</button>
                                    <button onClick={() => setSellerType('mall')} className={`flex-1 py-1.5 px-3 rounded text-sm transition-colors border ${sellerType === 'mall' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>å•†åŸ/å…¶ä»– (ç„¡ä¸Šé™)</button>
                                </div>
                            </div>

                            <div className="space-y-5">
                                {/* Promo */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">æª”æœŸè¨­å®š</label>
                                    <div className="flex flex-wrap gap-2">
                                        <button onClick={() => setIsPromo(false)} className={`px-4 py-2 rounded-lg text-sm border transition-all ${!isPromo ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>éæª”æœŸ (ä¸€èˆ¬æ—¥)</button>
                                        <button onClick={() => setIsPromo(true)} className={`px-4 py-2 rounded-lg text-sm border transition-all ${isPromo ? 'bg-orange-500 text-white border-orange-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>ğŸ”¥ ä¿ƒéŠ·æª”æœŸ / æ´»å‹•æ—¥</button>
                                    </div>
                                </div>

                                {/* FSS */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">å…é‹æ–¹æ¡ˆ (FSS)</label>
                                    <div className="flex flex-wrap gap-2">
                                        <button onClick={() => setIsFSS(false)} className={`px-4 py-2 rounded-lg text-sm border transition-all ${!isFSS ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>æœªåƒåŠ </button>
                                        <button onClick={() => setIsFSS(true)} className={`px-4 py-2 rounded-lg text-sm border transition-all ${isFSS ? 'bg-green-600 text-white border-green-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>åƒåŠ å…é‹æ–¹æ¡ˆ</button>
                                    </div>
                                </div>

                                {/* CCB */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">è¦å¹£å›é¥‹ (CCB)</label>
                                    <div className="flex flex-wrap gap-2">
                                        <button onClick={() => setCcbType('none')} className={`px-4 py-2 rounded-lg text-sm border transition-all ${ccbType === 'none' ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>ä¸åƒåŠ </button>
                                        <button onClick={() => setCcbType('10')} className={`px-4 py-2 rounded-lg text-sm border transition-all ${ccbType === '10' ? 'bg-yellow-500 text-white border-yellow-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>10%å›é¥‹ {isFSS ? '(2.5%)' : '(3%)'}</button>
                                        <button onClick={() => setCcbType('5')} className={`px-4 py-2 rounded-lg text-sm border transition-all ${ccbType === '5' ? 'bg-yellow-400 text-white border-yellow-400 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>5%å›é¥‹ (1.5%)</button>
                                    </div>
                                    {isFSS && ccbType === '10' && <div className="text-xs text-orange-500 mt-1 pl-1">âœ¨ å·²å¥—ç”¨å…é‹çµ„åˆå„ªæƒ  (-0.5%)</div>}
                                </div>

                                {/* PreOrder */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">å‡ºè²¨å¤©æ•¸</label>
                                    <div className="flex flex-wrap gap-2">
                                        <button onClick={() => setIsPreOrder(false)} className={`px-4 py-2 rounded-lg text-sm border transition-all ${!isPreOrder ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>âš¡ å¿«é€Ÿå‡ºè²¨</button>
                                        <button onClick={() => setIsPreOrder(true)} className={`px-4 py-2 rounded-lg text-sm border transition-all ${isPreOrder ? 'bg-red-500 text-white border-red-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>è¼ƒé•·å‚™è²¨ (+3%æ‰‹çºŒè²»)</button>
                                    </div>
                                </div>

                                {/* Tax */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">ç™¼ç¥¨ç¨…ç‡</label>
                                    <div className="flex flex-wrap gap-2 items-center">
                                        <button onClick={() => handleTaxSelection('0')} className={`px-4 py-2 rounded-lg text-sm border transition-all ${taxRate === 0 ? 'bg-gray-600 text-white border-gray-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>ä¸é–‹ç™¼ç¥¨ (0%)</button>
                                        <button onClick={() => handleTaxSelection('1')} className={`px-4 py-2 rounded-lg text-sm border transition-all ${taxRate === 1 ? 'bg-blue-500 text-white border-blue-500 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>ç¨…ç± (1%)</button>
                                        <button onClick={() => handleTaxSelection('5')} className={`px-4 py-2 rounded-lg text-sm border transition-all ${taxRate === 5 && !isShopeeInvoice ? 'bg-blue-600 text-white border-blue-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>ç™¼ç¥¨ (5%)</button>
                                        <button onClick={() => handleTaxSelection('shopee')} className={`px-4 py-2 rounded-lg text-sm border transition-all ${isShopeeInvoice ? 'bg-purple-600 text-white border-purple-600 shadow-sm font-medium' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}>è¦çš®ä»£é–‹ (5%+$2.5)</button>

                                        <div className="relative w-24">
                                            <input
                                                type="number"
                                                value={taxRate}
                                                onChange={(e) => setTaxRate(Number(e.target.value))}
                                                className="w-full pl-2 pr-6 py-2 border border-gray-300 rounded-lg text-sm text-center focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none"
                                            />
                                            <span className="absolute right-2 top-2 text-gray-500 text-xs">%</span>
                                        </div>
                                    </div>
                                    {isShopeeInvoice && (
                                        <div className="text-xs text-purple-600 mt-2 p-2 bg-purple-50 rounded border border-purple-100">
                                            â„¹ï¸ <strong>è¦çš®ä»£é–‹èªªæ˜ï¼š</strong>æ¯å¼µç™¼ç¥¨åŠ æ”¶ 2.5 å…ƒ (ç³»çµ±è¨ˆç®—ä»¥å››æ¨äº”å…¥ 3 å…ƒè¨ˆå…¥æˆæœ¬)ã€‚
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Rates Read-only Display */}
                            <div className="mt-6 pt-4 border-t border-gray-100 grid grid-cols-2 sm:grid-cols-4 gap-4 text-xs text-gray-500 bg-gray-50 p-3 rounded-lg">
                                <div>
                                    <div className="mb-1">æˆäº¤æ‰‹çºŒè²»</div>
                                    <div className="font-mono font-medium text-gray-700 text-base">{transFeeRate}% {isPreOrder && <span className="text-red-500">+3%</span>}</div>
                                </div>
                                <div>
                                    <div className="mb-1">æ´»å‹•æœå‹™è²»</div>
                                    <div className="font-mono font-medium text-gray-700 text-base">{serviceFeeRate}%</div>
                                </div>
                                <div>
                                    <div className="mb-1">é‡‘æµæœå‹™è²»</div>
                                    <div className="font-mono font-medium text-gray-700 text-base">{paymentFeeRate}%</div>
                                </div>
                                <div>
                                    <div className="mb-1">ç¨…ç‡</div>
                                    <div className="font-mono font-medium text-gray-700 text-base">{taxRate}% {isShopeeInvoice && <span className="text-purple-600">+$3</span>}</div>
                                </div>
                            </div>

                            {/* Manual Rates Override (Hidden/Secondary) */}
                            <div className="mt-2 text-center">
                                <details className="text-xs text-gray-400 cursor-pointer">
                                    <summary>é€²éš: æ‰‹å‹•èª¿æ•´è²»ç‡</summary>
                                    <div className="grid grid-cols-4 gap-2 mt-2 text-left">
                                        <div><label>æˆäº¤%</label><input type="number" value={transFeeRate} onChange={(e) => setTransFeeRate(e.target.value)} className="w-full border rounded px-1"/></div>
                                        <div><label>æ´»å‹•%</label><input type="number" value={serviceFeeRate} onChange={(e) => setServiceFeeRate(e.target.value)} className="w-full border rounded px-1"/></div>
                                        <div><label>é‡‘æµ%</label><input type="number" value={paymentFeeRate} onChange={(e) => setPaymentFeeRate(e.target.value)} className="w-full border rounded px-1"/></div>
                                        <div><label>ç¨…ç‡%</label><input type="number" value={taxRate} onChange={(e) => setTaxRate(e.target.value)} className="w-full border rounded px-1"/></div>
                                    </div>
                                </details>
                            </div>
                        </div>

                        {/* 3. Main Results Section */}
                        <div className={`bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden ${mainResults.isImpossible ? 'opacity-70' : ''}`}>
                            <div className={`p-4 border-b border-gray-200 flex justify-between items-center ${mode === 'price' ? 'bg-orange-50' : 'bg-gray-50'}`}>
                                <h2 className="font-bold text-gray-700 flex items-center">{mode === 'price' && <span className="mr-2 text-lg">ğŸ¯</span>}è©¦ç®—çµæœ (ä¾ä¸Šæ–¹è¨­å®š)</h2>
                                <div className="text-sm text-gray-500">{mode === 'price' ? 'ç›®æ¨™: ' + targetMargin + '% åˆ©æ½¤ç‡' : 'éŠ·å”®ç¸½é¡: $' + mainResults.totalSales.toLocaleString()}</div>
                            </div>

                            {mainResults.isImpossible ? (
                                <div className="p-8 text-center text-red-500 font-bold"><div className="text-2xl mb-2">âš ï¸ ç„¡æ³•è¨ˆç®—</div><p className="text-sm text-gray-600">è²»ç”¨å·²è¶…é 100%</p></div>
                            ) : (
                                <div className="p-5 space-y-3">
                                    {mode === 'price' && (
                                        <div className="mb-6 text-center border-b pb-5 border-dashed border-gray-300">
                                            <p className="text-sm text-gray-500 mb-1">å»ºè­°æœ€å°‘å”®åƒ¹</p>
                                            <div className="text-4xl font-extrabold text-shopee">${mainResults.finalPrice.toLocaleString()}</div>
                                            <p className="text-xs text-gray-400 mt-2">å¯å¯¦æ‹¿ ${mainResults.profit.toLocaleString()} åˆ©æ½¤</p>
                                        </div>
                                    )}
                                    <div className="flex justify-between items-center text-sm text-gray-600">
                                        <span className="flex items-center">
                                            æˆäº¤æ‰‹çºŒè²»
                                            {isPreOrder && <span className="ml-1 text-xs text-red-500 font-bold">(+3% å‚™è²¨)</span>}
                                            {mainResults.capApplied && <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-1 rounded">ä¸Šé™</span>}
                                        </span>
                                        <span>-${mainResults.transFee.toLocaleString()}</span>
                                    </div>
                                    <div className="flex justify-between items-center text-sm text-gray-600"><span>æ´»å‹•æœå‹™è²»</span><span>-${mainResults.serviceFee.toLocaleString()}</span></div>
                                    <div className="flex justify-between items-center text-sm text-gray-600"><span>é‡‘æµæœå‹™è²»</span><span>-${mainResults.paymentFee.toLocaleString()}</span></div>
                                    {mainResults.taxAmount > 0 && <div className="flex justify-between items-center text-sm text-gray-600"><span>é ä¼°ç¨…é‡‘ {isShopeeInvoice ? '(å«ä»£é–‹è²»)' : ''}</span><span>-${mainResults.taxAmount.toLocaleString()}</span></div>}
                                    <div className="h-px bg-gray-200 my-2"></div>
                                    <div className="flex justify-between items-center font-medium text-red-500"><span>è²»ç”¨ç¸½è¨ˆ</span><span>-${(mainResults.totalFees + mainResults.taxAmount).toLocaleString()}</span></div>
                                    <div className="mt-4 bg-orange-50 rounded-lg p-4 border border-orange-100 flex justify-between items-center">
                                        <span className="text-gray-600 font-medium">æ·¨åˆ©æ½¤</span>
                                        <div className="text-right">
                                            <div className="text-2xl font-bold text-shopee">${mainResults.profit.toLocaleString()}</div>
                                            <div className="text-xs text-gray-500">åˆ©æ½¤ç‡: {mainResults.profitMargin.toFixed(1)}%</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* 4. Scenario Comparison Section */}
                        <div className="bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden mt-8">
                            <div className="bg-gray-800 text-white p-4 flex justify-between items-center">
                                <h2 className="font-bold flex items-center text-lg"><span className="mr-2">ğŸ“Š</span> ç²åˆ©ç¸½è¦½èˆ‡ç­–ç•¥åˆ†æ</h2>
                                <span className="text-xs bg-gray-700 px-2 py-1 rounded text-gray-300">æ¯”è¼ƒã€ŒåƒåŠ FSSã€vsã€Œè‡ªè¡Œå¸æ”¶é‹è²»ã€</span>
                            </div>

                            <div className="p-4 bg-gray-50 border-b border-gray-200 text-sm grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="text-gray-500 text-xs block mb-1">æ¯”è¼ƒåƒæ•¸ï¼šå®˜æ–¹å…é‹è²»ç‡ (æ–¹æ¡ˆä¸€)</label>
                                    <div className="flex items-center">
                                        <input type="number" value={compFSSRate} onChange={(e)=>setCompFSSRate(e.target.value)} className="w-16 p-1 border rounded text-center text-sm" />
                                        <span className="ml-1">%</span>
                                    </div>
                                    <div className="text-xs text-blue-500 mt-1">è‹¥åŒæ™‚åƒåŠ è¦å¹£ï¼Œè«‹å¡«å…¥åŠ ç¸½è²»ç‡ (ä¾‹: 6+2.5=8.5)</div>
                                </div>
                                <div>
                                    <label className="text-gray-500 text-xs block mb-1">æ¯”è¼ƒåƒæ•¸ï¼šæ–¹æ¡ˆäºŒ å®šé¡è²»ç”¨</label>
                                    <div className="flex items-center">
                                        <span className="mr-1">$</span>
                                        <input type="number" value={compShippingCost} onChange={(e)=>setCompShippingCost(e.target.value)} className="w-16 p-1 border rounded text-center text-sm" />
                                    </div>
                                </div>
                            </div>

                            {!comparisonResults.hasData ? (
                                <div className="p-10 text-center text-gray-400">
                                    <div className="text-4xl mb-3">ğŸ”¢</div>
                                    <p>è«‹è¼¸å…¥å•†å“æˆæœ¬ä»¥æŸ¥çœ‹ç­–ç•¥åˆ†æçµæœ</p>
                                </div>
                            ) : (
                                <div className="p-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="space-y-4">
                                        <h3 className="font-bold text-gray-700 border-l-4 border-blue-400 pl-2">ğŸ“… éæª”æœŸ (ä¸€èˆ¬æ—¥ 6.0%)</h3>
                                        <ResultCard title="å…é‹æ–¹æ¡ˆä¸€ (åƒåŠ FSS)" badge={<span className="text-xs bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded">æ‰£ {compFSSRate}%</span>} data={comparisonResults.gen_fss} isBest={comparisonResults.gen_fss.suggestedPrice === comparisonResults.minGenPrice} />
                                        <ResultCard title="å…é‹æ–¹æ¡ˆäºŒ (å®šé¡$60)" badge={<span className="text-xs bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded">å®šé¡ ${compShippingCost}</span>} data={comparisonResults.gen_scheme2} isBest={comparisonResults.gen_scheme2.suggestedPrice === comparisonResults.minGenPrice} />
                                    </div>
                                    <div className="space-y-4">
                                        <h3 className="font-bold text-gray-700 border-l-4 border-orange-400 pl-2">ğŸ”¥ æ´»å‹•æ—¥ (æª”æœŸ 7.5%)</h3>
                                        <ResultCard title="å…é‹æ–¹æ¡ˆä¸€ (åƒåŠ FSS)" badge={<span className="text-xs bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded">æ‰£ {compFSSRate}%</span>} data={comparisonResults.promo_fss} isBest={comparisonResults.promo_fss.suggestedPrice === comparisonResults.minPromoPrice} />
                                        <ResultCard title="å…é‹æ–¹æ¡ˆäºŒ (å®šé¡$60)" badge={<span className="text-xs bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded">å®šé¡ ${compShippingCost}</span>} data={comparisonResults.promo_scheme2} isBest={comparisonResults.promo_scheme2.suggestedPrice === comparisonResults.minPromoPrice} />
                                    </div>
                                </div>
                            )}

                            <div className="bg-gray-50 p-3 text-xs text-gray-500 border-t text-center">
                                ç­–ç•¥æ¯”è¼ƒä»¥ã€å‰å°å…é‹ï¼ˆè²·å®¶é‹è²»=0ï¼‰ã€ç‚ºçµ±ä¸€å‡è¨­ï¼Œç”¨ä¾†æ¯”è¼ƒå…©ç¨®åšæ³•èª°èƒ½è¨‚æ›´ä½çš„å”®åƒ¹ã€‚
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Calculator />);
    </script>
</body>
</html>
